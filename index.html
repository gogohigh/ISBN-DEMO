<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ëª¨ë‘ì˜ì±…ê°ˆí”¼ ë°ëª¨</title>
  <script src="https://unpkg.com/@zxing/library@latest"></script>
</head>
<body>
  <h1>ğŸ“š ëª¨ë‘ì˜ì±…ê°ˆí”¼ ë°ëª¨!</h1>
  <video id="video" width="320" height="240" style="border:1px solid black"></video>
  
  <p>ì¸ì‹ëœ ISBN: <span id="isbn">ì—†ìŒ</span></p>
  <div id="book-info"></div>

  <script>
    const hints = new Map();
    hints.set(ZXing.DecodeHintType.POSSIBLE_FORMATS, [ZXing.BarcodeFormat.EAN_13]);
    const codeReader = new ZXing.BrowserMultiFormatReader(hints);

    const video = document.getElementById('video');
    const isbnEl = document.getElementById('isbn');
    const infoEl = document.getElementById('book-info');

    async function fetchBook(isbn) {
      const res = await fetch(`https://www.googleapis.com/books/v1/volumes?q=isbn:${isbn}`);
      const data = await res.json();
      if (data.totalItems > 0) {
        const book = data.items[0].volumeInfo;
        infoEl.innerHTML = `
          <h2>${book.title}</h2>
          <p><strong>ì €ì:</strong> ${book.authors ? book.authors.join(", ") : "ì•Œ ìˆ˜ ì—†ìŒ"}</p>
          ${book.imageLinks?.thumbnail ? `<img src="${book.imageLinks.thumbnail}" alt="ì±… í‘œì§€">` : ""}
        `;
      } else {
        infoEl.innerHTML = "<p>âŒ ì±… ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>";
      }
    }

    codeReader.listVideoInputDevices().then(videoInputDevices => {
      const deviceId = videoInputDevices.length > 1
        ? videoInputDevices[videoInputDevices.length - 1].deviceId
        : videoInputDevices[0].deviceId;

      codeReader.decodeFromVideoDevice(deviceId, video, (result, err) => {
        if (result) {
          const isbn = result.getText();
          isbnEl.textContent = isbn;
          console.log("ğŸ“Œ ì¸ì‹ëœ ISBN:", isbn);
          fetchBook(isbn); // ì±… ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
        }
        if (err && !(err instanceof ZXing.NotFoundException)) {
          console.error("ì—ëŸ¬ ë°œìƒ:", err);
        }
      });
    });
  </script>
</body>
</html>
